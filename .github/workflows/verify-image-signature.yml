name: Verify Image Signature

on:
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Install cosign
        run: |
          COSIGN_VERSION="2.1.0"
          curl -sSL -o cosign.tar.gz "https://github.com/sigstore/cosign/releases/download/v${COSIGN_VERSION}/cosign-linux-amd64.tar.gz"
          tar -xzf cosign.tar.gz cosign
          sudo mv cosign /usr/local/bin/cosign

      - name: Verify image signature
        env:
          IMAGE: ghcr.io/yourorg/your-image:TAG
        run: |
          # public key should be stored in repo or in secret
          echo "${{ secrets.COSIGN_PUB }}" > cosign.pub
          cosign verify --key cosign.pub "$IMAGE"
